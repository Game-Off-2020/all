name: Deploy
on:
   push:
      branches:
         - prod
jobs:
   build:
      name: Build
      runs-on: ubuntu-latest
      steps:
         - name: Checkout Repo
           uses: actions/checkout@master
         - name: Install Dependencies
           run: npm ci
         - name: Build Server
           run: npm run build:prod:server
         - name: Build Client
           run: npm run build:prod:client
         - name: Archive Production Artifact
           uses: actions/upload-artifact@master
           with:
              name: dist
              path: dist
   deploy-front-end:
      name: Deploy Front-End
      needs: [build]
      runs-on: ubuntu-latest
      steps:
         - name: Download Artifact
           uses: actions/download-artifact@master
           with:
              name: dist
              path: dist
         - name: Deploy ðŸš€
           uses: JamesIves/github-pages-deploy-action@3.7.1
           with:
              GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              BRANCH: gh-pages
              FOLDER: dist/client
   deploy-back-end:
      name: Deploy Back-End
      needs: [build]
      runs-on: ubuntu-latest
      defaults:
         run:
            working-directory: dist/server
      steps:
         - name: Download Artifact
           uses: actions/download-artifact@master
           with:
              name: dist
              path: dist
         - name: Deploy ðŸš€
           uses: kanadgupta/glitch-sync@master
           with:
              project-id: '${{ secrets.GLITCH_PROJECT_ID }}'
              auth-token: '${{ secrets.GLITCH_AUTH_TOKEN }}'
